---
title: "Analisis Exploratorio de Datos - Proyecto Final Estadistica I "
author: "David Zapata - Marian Becerra"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

# Consumo de Sustancias Psicoactivas en Santander

# Introducción

El ministerio de Justicia y Derecho de Colombia observo el consumo de sustancias psicoactivas como un problema crítico, no solo por el aumento que se evidencia día a día, sino por las características que lo hacen un asunto complejo en el tema social y de salud pública.

Se reconoce que, aunque en algunos casos el dejar el consumo es un proceso sencillo, en otros el consumo de sustancias se vuelve persistente y logra afectar la salud, las relaciones sociales, familiares, laborales y/o académicas; la diferencia entre estos puede radicar en varios aspectos como lo son la sustancia, la persona y su contexto social.

En conjunto al ministerio de Justicia, el Departamento Administrativo Nacional de Estadística (DANE) en el año 2019 realizo la *Encuesta Nacional de Consumo de Sustancias Psicoactivas en la Población General (ENCSPA-2019)* esto con el fin de conocer la situación del país en ese momento, para así, diseñar acciones de política pública, planes, programas y proyectos de forma nacional, departamental y municipal.

Conociendo esto, se logra plantear la pregunta ¿qué patrones se logran encontrar en los consumidores de sustancias psicoactivas en base a este estudio estadístico?, para la cual se encontrará respuesta a lo largo de este análisis. .\

# Metodología

Mediante la recopilación de los datos que el DANE tiene con acceso público respecto a *Encuesta Nacional de Consumo de Sustancias Psicoactivas en la Población General* se lleva a cabo una investigación documental, donde se recopilo la información necesaria.

En su sitio web se puede acceder de forma separada los datos correspondientes a las personas y las características generales de quienes consumen cada una de las sustancias caracterizadas, los cuales fueron tratados de la siguiente forma:

1.  Recopilación y Elección de Datos

1.1. Descargar los archivos .zip ya que estos almacenaban los .csv que contenidan los datos sin filtro alguno contabamos con mucha información que no tenia ningun tipo de relevancia para la pregunta de investigación planteada.

1.2. Revisión de los items y diccionario de datos de las encuestas realizadas que nos permitieran observar ciertos comportamientos en los datos que además de ellos fueran persistentes en las sustancias y las personas seleccionadas.

1.3. Se eligen como variables de estudio características específicas que se presentan en todas las personas a la que se le realizó la encuesta, y se acotan las sustancias psicoactivas a las cuales se les prestará atención.

2.  Selección, fusión y constraste de datos.

2.1.   Se fija como sustancias a estudiar el bazuco, la cocaína, el éxtasis, la heroína y la marihuana, donde se observa cuando se dio la primera vez y si dentro de los últimos 12 meses la persona había consumido el psicoactivo.

2.2.  Del mismo modo, se seleccionan como ítems necesarios a estudiar en las características de las personas como lo son aporte al hogar, en que ocupan su tiempo, estado de salud, si pertenece a alguna minoría, el nivel educativo máximo alcanzado, su orientación sexual, identidad de género, el sexo de nacimiento y la edad.

2.3.  Se toman los respectivos *.csv* de cada sustancia de donde se extrae la columna “Directorio” la cual contiene una clave por persona, cuya unicidad permite la fusión desde los archivos donde se encuentran las características de las personas que consumen dicha sustancia, al igual que el código de departamento desde la columna “Depmuni”, el cual permite más adelante el clasificado por departamento de los datos fusionados.

3.  Filtrado y Análisis de Datos

3.1.   Una vez se tiene los archivos con la información necesaria, se inicia un proceso de depuración en donde se dejan únicamente los datos con los cuales se va a trabajar, esto tiene el fin de que el manejo de los mismos sea más sencillo en términos computacionales.Para ello se hizo uso de librerias como read y dplyr.

Para este se usaron dos soluciones de filtrado por departamento, las cuales se pueden encontrar en los archivos *.r* adicionales, cuya rutina se ve similar a la siguiente:

<details>

<summary>Mostrar/Ocultar Código</summary>

```{r clasificacion, eval = FALSE, echo = TRUE, collapse=TRUE}
#load(consumidores_total_colombia)
library(readr)
library(dplyr)

#load(consumidores_total_colombia)

consumidores_huila <- consumidores_total_colombia %>%
filter(startsWith(as.character(consumidores_total_colombia$Depmuni), "41"))
write.csv(consumidores_huila, "consumidores_huila.csv", row.names = FALSE)

consumidores_marihuna_huila <- consumdores_marihuana_colombia %>% filter(startsWith(as.character(consumdores_marihuana_colombia$Depmuni), "41"))
write.csv(consumidores_marihuna_huila, "consumidores_marihuna_huila.csv", row.names = FALSE)

```

3.2.  Como primer ítem se hace el análisis del consumo por departamento de cada una de las sustancias evaluadas, cuyo resultado se verá en el *mapa de calor* con respecto al consumo de sustancias psicoactivas en el país.

![](images/Mapa%20de%20calor.png)

El cual resulta de codigo y herramientas, como se ve a continuación:

<details>

<summary>Mostrar/Ocultar Código</summary>

```{r extraccion de totales y mapeo, eval = FALSE, echo = TRUE, collapse=TRUE}
library(sf)
library(ggplot2)
library(readr)
library(dplyr)
library(viridis)

orden_departamentos <- data.frame(
  departamentos = c("VAUPÉS", "ANTIOQUIA", "ATLÁNTICO", "BOGOTÁ, D.C.", "BOLÍVAR", "BOYACÁ", "CALDAS", "CAQUETÁ", "CAUCA", "CESAR", "CÓRDOBA", "CUNDINAMARCA", "CHOCÓ", "HUILA", "LA GUAJIRA", "MAGDALENA", "META", "NARIÑO", "NORTE DE SANTANDER", "QUINDIO", "RISARALDA", "SANTANDER", "SUCRE", "TOLIMA", "VALLE DEL CAUCA", "ARAUCA", "CASANARE", "PUTUMAYO", "GUAINÍA", "GUAVIARE", "VICHADA", "AMAZONAS"),
  consumo_total = c(total_vaupes, total_antioquia, total_atlantico, total_bogota, total_bolivar,total_boyaca, total_caldas, total_caqueta, total_cauca, total_cesar, total_cordoba, total_cundinamarca, total_choco, total_huila, total_guajira, total_magdalena, total_meta, total_nariño, total_nsantander, total_quindio, total_risaralda, total_santander, total_sucre, total_tolima, total_vcauca, total_arauca, total_casanare, total_putumayo, total_guania, total_guaviare, total_vichada, total_amazonas))

mapa_consumo <- mapa_colombia_codigo %>%
  left_join(orden_departamentos, by = c("DPTO_CNMBR" = "departamentos")) 

ggplot(data = mapa_consumo) +
  geom_sf(aes(fill = consumo_total)) +
  scale_fill_viridis(option = "plasma", na.value = "grey") +
  theme_minimal() +
  labs(title = "Consumo de Sustancias Psicoactivas en Colombia",
       fill = "Consumo")
```

3.3.  Se eligen los 4 departamentos donde se observan los valores de mayor consumo en total de sustancias psicoactivas, los cuales son Antioquia, Santander y Valle del Cauca, adicional a ello la ciudad de Bogotá D.C, en donde se realiza el análisis de cada una de las variables nombradas anteriormente por cada una de las sustancias psicoactivas, cuyos resultados darán pie a la discusión y respuesta de la pregunta de investigación.

# Analisis de consumo basado en Santander

Luego de realizar todo el proceso anterior con los datos de Santander, filtrando los datos según la ocupación, el estado de salud, si pertenece a alguna minoría, el nivel educativo máximo alcanzado, su orientación sexual, identidad de género, el sexo de nacimiento y la edad, separando cada una por la sustancia que consume la persona, antes se realizaron *mapas de calor* del consumo de por cada sustancia en el departamento analizando cada uno de sus municipios:

![](images/Mapa%20de%20consumo%20de%20marihuana%20en%20santander.png)

![](images/Mapa%20consumo%20de%20basuco%20en%20santander.png)

![](images/Mapa%20consumo%20de%20cocaina%20en%20santander.png)

![](images/Mapa%20consumo%20de%20extasis%20en%20satander.png)

![](images/Mapa%20consumo%20de%20heroina%20en%20santander.png)

para dichos mapa se hizo uso de librerias y código mostrado a continuación (donde se encuentren "..." correponde a datos adicionales que no se muestran pero que son necesarios):

<details>

<summary>Mostrar/Ocultar Código</summary>

```{r extraccion de datos y mapeo Santander, eval=FALSE,echo = TRUE,  collapse=TRUE}
library(readr)
library(dplyr)
library(sf)
library(ggplot2)
library(viridis)

municipios_santander <- c(
  "Aguada" = "68013",
  "Albania" = "68020",
  "Aratoca" = "68051",
  "Barbosa" = "68077",
  "Barichara" = "68079","...")

datos_consumidores <- list()

for (municipio in names(municipios_santander)) {
  codigo <- municipios_santander[municipio]
  
  datos_consumidores[[municipio]] <- csv_con_valores_completos$consumidores_extasis_santander.csv %>%
    filter(startsWith(as.character(csv_con_valores_completos$consumidores_extasis_santander.csv$Depmuni), codigo))
}

total_bucaramanga <- nrow(datos_consumidores[["Bucaramanga"]])
total_aguada <- nrow(datos_consumidores[["Aguada"]])
total_albania <- nrow(datos_consumidores[["Albania"]])
total_aratoca <- nrow(datos_consumidores[["Aratoca"]])
"....."

consumo_extasis_por_municipio_santander <- data.frame(
  municipios = c("ZAPATOCA", "PUERTO WILCHES", "MALAGA", "CARCASI", "LA BELLEZA", "CAPITANEJO", "SANTA HELENA DEL OPON", "LA PAZ", "SUAITA", "MATANZA", 
                 "LOS SANTOS", "GALAN", "SUCRE", "PUENTE NACIONAL", "GAMBITA", "MAGDALENA", "GUAVATA", "MOLAGAVITA", "BARBOSA", "..."),
  consumo_total = c(0,0,0,0,0,0,0,0,0,0,"..."))

mapa_santander <- st_read("C:/Users/ASUS/Desktop/Estadistica/Estadistica_1__Grupo_E2___PROYECTO__INVESTIGACION___DAVID_ALEJANDRO_ZAPATA_TORO/DATOS DANE/Datos separados/Mapeo/Mapas/shapes/shapes.shp")

mapa_santander_nombre_municipio <- mapa_santander[,6]

mapa_consumo_extasis_santander <- mapa_santander_nombre_municipio %>%
  left_join(consumo_extasis_por_municipio_santander, by = c("nombre_mpi" = "municipios")) 

ggplot(data = mapa_consumo_extasis_santander) +
  geom_sf(aes(fill = consumo_total)) +
  scale_fill_viridis(option = "plasma", na.value = "grey") +
  theme_minimal() +
  labs(title = "Consumo de extasis Santander",
       fill = "Consumo")

```

El formato anterior se uso para cada uno de los mapas generados por sustancia psicoactiva a estudiar.

De este mapeo podemos observar que la mayoria de consumidores de sustancias psicoactivas en Santander se encuentran en el area metropolitana que esta conformada por, Floridablanca, Bucaramanga, Piedecuesta y Girón.

# Analisis de variables

Para nuestro informe se sacaron graficas basandonos en las siguientes variables:

1.  Consumo de sustancias por primera vez

![](images/basuco%201%20santander.png)

![](images/cocaina%201%20santander.png)

![](images/extasis%201%20santander.png)

![](images/heroina%201%20santander.png)

![](images/marihuana%201%20santander.png)

La rutina para graficación y analisis es la misma para cada sustancia, variando unicamente en el nombre de la columna donde cada sustancia variaba de nombre.

<details>

<summary>Mostrar/Ocultar Código</summary>

```{r extraccion consumo primera vez, eval=FALSE, echo = TRUE, collapse=TRUE}
columna <- "M_01"
valores<-c("1", "2", "3", "9")
etiquetas <- c(
  "Últimos 30 días",
  "Hace más de +30 días,-12 meses",
  "Hace más de 12 meses",
  "No contesta"
)

cuentas <- c()

for (valor in valores) {
  cuenta <- sum(santander_basuco[[columna]] == valor)
  cuentas <- c(cuentas, cuenta) 
  if (valor == "1") {
    cat(sprintf("Personas que consumieron basuco por primera vez en los últimos 30 días en Santander: %s\n", cuenta))
  } else if (valor == "2") {
    cat(sprintf("Personas que consumieron basuco por primera vez hace más de 30 días pero menos de 12 meses en Santander: %s\n", cuenta))
  } else if (valor == "3") {
    cat(sprintf("Personas que consumieron basuco por primera vez hace más de 12 meses en Santander: %s\n", cuenta))
  } else if (valor == "9") {
    cat(sprintf("Personas que no contesta cuando consumieron basuco por primera vez en Santander: %s\n", cuenta))
  }
}

barplot(
  cuentas,
  names.arg = etiquetas,
  col = c("#c9ecaf", "#367c1a", "#58a92e", "#265409"),
  main = "Consumo de basuco por primera vez en Santander",
  xlab = "Tiempo",
  ylab = "Número de personas",
  ylim = c(-2, max(cuentas) + 10)
)

```

</details>

2.  Consumo y trabajo:

![](images/Basuco%20oficio%20Santander.png)

![](images/cocaina%20oficio%20santander.png)

![](images/extasis%20oficio%20santander.png)

![](images/heroina%20oficio%20santander.png)

![](images/marihuana%20oficio%20santander.png)

<details>

<summary>Mostrar/Ocultar Código</summary>

```{r consumo y trabajo, eval=FALSE, echo = TRUE, collapse=TRUE}
columna <- "D_02"
valores<-c("1", "2", "3", "4","5","6","7","8")
etiquetas <- c(
  "Trabajando",
  "Buscando Empleo",
  "Estudiando",
  "Oficios del Hogar",
  "Incapacitado",
  "Pensionado",
  "Ocio",
  "Otro"
)

cuentas <- c()

for (valor in valores) {
  cuenta <- sum(santander_basuco[[columna]] == valor)
  cuentas <- c(cuentas, cuenta)  # Agregar cada cuenta al vector
  
  if (valor == "1") {
    cat(sprintf("Personas que trabajan y consumen basuco: %s\n", cuenta))
  } else if (valor == "2") {
    cat(sprintf("Personas que buscan empleo y consumen basuco: %s\n", cuenta))
  } else if (valor == "3") {
    cat(sprintf("Personas que estudian y consumen basuco: %s\n", cuenta))
  } else if (valor == "4") {
    cat(sprintf("Personas que se encargan del oficio del hogar y consumen basuco: %s\n", cuenta))
  } else if (valor == "5") {
    cat(sprintf("Personas que estan incapacitados y consumen basuco: %s\n", cuenta))
  } else if (valor == "6") {
    cat(sprintf("Personas que estan pensionados y consumen basuco: %s\n", cuenta))
  } else if (valor == "7") {
    cat(sprintf("Personas que se dedican al ocio y consumen basuco: %s\n", cuenta))
  } else if (valor == "8") {
    cat(sprintf("Personas que se dedican a otras actividades y consumen basuco: %s\n", cuenta))
  }
  
}

barplot(
  cuentas,
  names.arg = etiquetas,
  col = c("#c9ecaf", "#367c1a", "#58a92e", "#265409","#c9ecaf", "#367c1a", "#58a92e", "#265409"),
  main = "Oficio del consumidor de basuco en Santander",
  xlab = "Tiempo",
  ylab = "Número de personas",
  ylim = c(0, max(cuentas) + 5)
)

#Oficio del consumidor cocaina 
cuentas <- c()
for (valor in valores) {
  cuenta <- sum(santander_cocaina[[columna]] == valor)
  cuentas <- c(cuentas, cuenta)  # Agregar cada cuenta al vector
  
  if (valor == "1") {
    cat(sprintf("Personas que trabajan y consumen cocaina: %s\n", cuenta))
  } else if (valor == "2") {
    cat(sprintf("Personas que buscan empleo y consumen cocaina: %s\n", cuenta))
  } else if (valor == "3") {
    cat(sprintf("Personas que estudian y consumen cocaina: %s\n", cuenta))
  } else if (valor == "4") {
    cat(sprintf("Personas que se encargan del oficio del hogar y consumen cocaina: %s\n", cuenta))
  } else if (valor == "5") {
    cat(sprintf("Personas que estan incapacitados y consumen cocaina: %s\n", cuenta))
  } else if (valor == "6") {
    cat(sprintf("Personas que estan pensionados y consumen cocaina: %s\n", cuenta))
  } else if (valor == "7") {
    cat(sprintf("Personas que se dedican al ocio y consumen cocaina: %s\n", cuenta))
  } else if (valor == "8") {
    cat(sprintf("Personas que se dedican a otras actividades y consumen cocaina: %s\n", cuenta))
  }
  
}

pie(
  cuentas,
  labels = etiquetas,
  main = "Oficio del consumidor de cocaina en Santander",
  col = c("#c9ecaf", "#367c1a", "#58a92e", "#265409","#c9ecaf", "#367c1a", "#58a92e", "#265409")
)


#Oficio del consumidor extasis 
cuentas <- c()
for (valor in valores) {
  cuenta <- sum(santander_extasis[[columna]] == valor)
  cuentas <- c(cuentas, cuenta)  # Agregar cada cuenta al vector
  if (valor == "1") {
    cat(sprintf("Personas que trabajan y consumen extasis: %s\n", cuenta))
  } else if (valor == "2") {
    cat(sprintf("Personas que buscan empleo y consumen extasis: %s\n", cuenta))
  } else if (valor == "3") {
    cat(sprintf("Personas que estudian y consumen extasis: %s\n", cuenta))
  } else if (valor == "4") {
    cat(sprintf("Personas que se encargan del oficio del hogar y consumen extasis: %s\n", cuenta))
  } else if (valor == "5") {
    cat(sprintf("Personas que estan incapacitados y consumen extasis: %s\n", cuenta))
  } else if (valor == "6") {
    cat(sprintf("Personas que estan pensionados y consumen extasis: %s\n", cuenta))
  } else if (valor == "7") {
    cat(sprintf("Personas que se dedican al ocio y consumen extasis: %s\n", cuenta))
  } else if (valor == "8") {
    cat(sprintf("Personas que se dedican a otras actividades y consumen extasis: %s\n", cuenta))
  }
  
}

barplot(
  cuentas,
  names.arg = etiquetas,
  col = c("#c9ecaf", "#367c1a", "#58a92e", "#265409","#c9ecaf", "#367c1a", "#58a92e", "#265409"),
  main = "Oficio del consumidor de extasis en Santander",
  xlab = "Tiempo",
  ylab = "Número de personas",
  ylim = c(0, max(cuentas) + 5)
)

#Oficio del consumidor heroina 
cuentas <- c()
for (valor in valores) {
  cuenta <- sum(santander_heroina[[columna]] == valor)
  cuentas <- c(cuentas, cuenta)  # Agregar cada cuenta al vector
  if (valor == "1") {
    cat(sprintf("Personas que trabajan y consumen heroina: %s\n", cuenta))
  } else if (valor == "2") {
    cat(sprintf("Personas que buscan empleo y consumen heroina: %s\n", cuenta))
  } else if (valor == "3") {
    cat(sprintf("Personas que estudian y consumen heroina: %s\n", cuenta))
  } else if (valor == "4") {
    cat(sprintf("Personas que se encargan del oficio del hogar y consumen heroina: %s\n", cuenta))
  } else if (valor == "5") {
    cat(sprintf("Personas que estan incapacitados y consumen heroina: %s\n", cuenta))
  } else if (valor == "6") {
    cat(sprintf("Personas que estan pensionados y consumen heroina: %s\n", cuenta))
  } else if (valor == "7") {
    cat(sprintf("Personas que se dedican al ocio y consumen heroina: %s\n", cuenta))
  } else if (valor == "8") {
    cat(sprintf("Personas que se dedican a otras actividades y consumen heroina: %s\n", cuenta))
  }
  
}

barplot(
  cuentas,
  names.arg = etiquetas,
  col = c("#c9ecaf", "#367c1a", "#58a92e", "#265409","#c9ecaf", "#367c1a", "#58a92e", "#265409"),
  main = "Oficio del consumidor de heroina en Santander",
  xlab = "Tiempo",
  ylab = "Número de personas",
  ylim = c(0, max(cuentas) + 5)
)

#Oficio del consumidor marihuana 
cuentas <- c()
for (valor in valores) {
  cuenta <- sum(santander_marihuana[[columna]] == valor)
  cuentas <- c(cuentas, cuenta)  # Agregar cada cuenta al vector
  
  if (valor == "1") {
    cat(sprintf("Personas que trabajan y consumen marihuana: %s\n", cuenta))
  } else if (valor == "2") {
    cat(sprintf("Personas que buscan empleo y consumen marihuana: %s\n", cuenta))
  } else if (valor == "3") {
    cat(sprintf("Personas que estudian y consumen marihuana: %s\n", cuenta))
  } else if (valor == "4") {
    cat(sprintf("Personas que se encargan del oficio del hogar y consumen marihuana: %s\n", cuenta))
  } else if (valor == "5") {
    cat(sprintf("Personas que estan incapacitados y consumen marihuana: %s\n", cuenta))
  } else if (valor == "6") {
    cat(sprintf("Personas que estan pensionados y consumen marihuana: %s\n", cuenta))
  } else if (valor == "7") {
    cat(sprintf("Personas que se dedican al ocio y consumen marihuana: %s\n", cuenta))
  } else if (valor == "8") {
    cat(sprintf("Personas que se dedican a otras actividades y consumen marihuana: %s\n", cuenta))
  }
  
}

pie(
  cuentas,
  labels = etiquetas,
  main = "Oficio del consumidor de marihuana en Santander",
  col = c("#c9ecaf", "#367c1a", "#58a92e", "#265409","#c9ecaf", "#367c1a", "#58a92e", "#265409")
)

```

</details>

3.  Consumo y educación:

![](images/basuco%20educacion%20santander.png)

![](images/cocaina%20educacion%20santander.png)

![](images/extasis%20educacion%20santander.png)

![](images/heroina%20educacion%20santander.png)

![](images/marihuana%20eduacion%20santander.png)

Para el analisis anterior se siguio la sisguiente rutina:

<details>

<summary>Mostrar/Ocultar Código</summary>

```{r consumo y educacion, eval=FALSE, echo = TRUE, collapse=TRUE}
reporte_neducativo<- function(data, columna, valores, etiquetas, nombre_consumo, departamento, titulo_grafico) {
  cuentas <- c()
  
  for (i in seq_along(valores)) {
    valor <- valores[i]
    cuenta <- sum(data[[columna]] == valor)
    cuentas <- c(cuentas, cuenta)
    
    cat(sprintf(
      "Personas que consumen %s y tienen nivel educativo %s en %s: %s\n", 
      nombre_consumo, etiquetas[i], departamento, cuenta
    ))
  }
  
  # Generar el gráfico
  barplot(
    cuentas,
    names.arg = etiquetas,
    col = c("#c9ecaf", "#367c1a", "#58a92e", "#265409", "#58a92e", "#367c1a", "#c9ecaf", "#367c1a", "#58a92e"),
    main = sprintf("%s en %s", titulo_grafico, departamento),
    xlab = "Nivel Educativo",
    ylab = "Número de Personas",
    ylim = c(0, max(cuentas) + 5)
  )
}

reporte_neducativo(
  data = santander_basuco,
  columna = "D2_05",
  valores = c("1", "2", "3", "4", "5","6", "7", "8", "9"),
  etiquetas = c("Ninguno", "Preescolar", "Basica Primaria", "Basica Secuandaria", "Media", "Técnica/Tecnologica", "Universitaria", "Postgrado", "No sabe/informa"),
  nombre_consumo = "basuco",
  departamento = "Santander",
  titulo_grafico = "Nivel educativo del consumidor de basuco"
)

reporte_neducativo(
  data = santander_cocaina,
  columna = "D2_05",
  valores = c("1", "2", "3", "4", "5","6", "7", "8", "9"),
  etiquetas = c("Ninguno", "Preescolar", "Basica Primaria", "Basica Secuandaria", "Media", "Técnica/Tecnologica", "Universitaria", "Postgrado", "No sabe/informa"),
  nombre_consumo = "cocaina",
  departamento = "Santander",
  titulo_grafico = "Nivel educativo del consumidor de cocaina"
)

reporte_neducativo(
  data = santander_extasis,
  columna = "D2_05",
  valores = c("1", "2", "3", "4", "5","6", "7", "8", "9"),
  etiquetas = c("Ninguno", "Preescolar", "Basica Primaria", "Basica Secuandaria", "Media", "Técnica/Tecnologica", "Universitaria", "Postgrado", "No sabe/informa"),
  nombre_consumo = "extasis",
  departamento = "Santander",
  titulo_grafico = "Nivel educativo del consumidor de extasis"
)

reporte_neducativo(
  data = santander_heroina,
  columna = "D2_05",
  valores = c("1", "2", "3", "4", "5","6", "7", "8", "9"),
  etiquetas = c("Ninguno", "Preescolar", "Basica Primaria", "Basica Secuandaria", "Media", "Técnica/Tecnologica", "Universitaria", "Postgrado", "No sabe/informa"),
  nombre_consumo = "heroina",
  departamento = "Santander",
  titulo_grafico = "Nivel educativo del consumidor de heroina"
)

reporte_neducativo(
  data = santander_marihuana,
  columna = "D2_05",
  valores = c("1", "2", "3", "4", "5","6", "7", "8", "9"),
  etiquetas = c("Ninguno", "Preescolar", "Basica Primaria", "Basica Secuandaria", "Media", "Técnica/Tecnologica", "Universitaria", "Postgrado", "No sabe/informa"),
  nombre_consumo = "marihuana",
  departamento = "Santander",
  titulo_grafico = "Nivel educativo del consumidor de marihuana"
)
```

</details>

4.  Consumo y por genero:

![](images/basuco%20S%20santander.png)

![](images/cocaina%20S%20santander.png)

![](images/extasis%20S%20santander.png)

![](images/heroina%20S%20santander.png)

![](images/marihuana%20S%20santander.png)

Para este analisis se siguio la siguiente rutina:

<details>

<summary>Mostrar/Ocultar Código</summary>

```{r consumo y sexo, eval=FALSE, echo = TRUE, collapse=TRUE}

columna <- "SEXO"
valores<-c("1", "2")
etiquetas <- c(
  "HOMBRE",
  "MUJER"
)
columna <- "SEXO"
cuentas <- c()

for (valor in valores) {
  cuenta <- sum(santander_basuco[[columna]] == valor)
  cuentas <- c(cuentas, cuenta)  # Agregar cada cuenta al vector
  
  if (valor == "1") {
    cat(sprintf("Hombres que consumen:: %s\n", cuenta))
  } else if (valor == "2") {
    cat(sprintf("Mujeres que consumen:: %s\n", cuenta))
  }
}

pie(
  cuentas,
  labels = etiquetas,
  main = "Sexo personas que consumen basuco  en Santander",
  col = c("#265409", "#367c1a")
)

#Sexo de los consumidores cocaina 
columna <- "SEXO"
cuentas <- c()

for (valor in valores) {
  cuenta <- sum(santander_cocaina[[columna]] == valor)
  cuentas <- c(cuentas, cuenta)  # Agregar cada cuenta al vector
  
  if (valor == "1") {
    cat(sprintf("Hombres que consumen:: %s\n", cuenta))
  } else if (valor == "2") {
    cat(sprintf("Mujeres que consumen:: %s\n", cuenta))
  }
}

pie(
  cuentas,
  labels = etiquetas,
  main = "Sexo personas que consumen cocaina en Santander",
  col = c("#265409", "#367c1a")
)


#Sexo de los consumidores extasis 
columna <- "SEXO"
cuentas <- c()

for (valor in valores) {
  cuenta <- sum(santander_extasis[[columna]] == valor)
  cuentas <- c(cuentas, cuenta)  # Agregar cada cuenta al vector
  
  if (valor == "1") {
    cat(sprintf("Hombres que consumen:: %s\n", cuenta))
  } else if (valor == "2") {
    cat(sprintf("Mujeres que consumen:: %s\n", cuenta))
  }
}

pie(
  cuentas,
  labels = etiquetas,
  main = "Sexo personas que consumen extasis en Santander",
  col = c("#265409", "#367c1a")
)

#Sexo de los consumidores heroina 
columna <- "SEXO"
cuentas <- c()

for (valor in valores) {
  cuenta <- sum(santander_heroina[[columna]] == valor)
  cuentas <- c(cuentas, cuenta)  # Agregar cada cuenta al vector
  
  if (valor == "1") {
    cat(sprintf("Hombres que consumen:: %s\n", cuenta))
  } else if (valor == "2") {
    cat(sprintf("Mujeres que consumen:: %s\n", cuenta))
  }
}

pie(
  cuentas,
  labels = etiquetas,
  main = "Sexo personas que consumen heroina en Santander",
  col = c("#265409", "#367c1a")
)


#Sexo de los consumidores marihuana 
columna <- "SEXO"
cuentas <- c()

for (valor in valores) {
  cuenta <- sum(santander_marihuana[[columna]] == valor)
  cuentas <- c(cuentas, cuenta)  # Agregar cada cuenta al vector
  
  if (valor == "1") {
    cat(sprintf("Hombres que consumen:: %s\n", cuenta))
  } else if (valor == "2") {
    cat(sprintf("Mujeres que consumen:: %s\n", cuenta))
  }
}

pie(
  cuentas,
  labels = etiquetas,
  main = "Sexo personas que consumen marihuana en Santander",
  col = c("#265409", "#367c1a")
)
```

</details>

5.  Consumo y raices culturales:

![](images/basuco%20cultura%20santander.png)

![](images/cocaina%20cultura%20santander.png)

![](images/extasis%20cultura%20santander.png)

![](images/heroina%20cultura%20santander.png)

![](images/marihuana%20cultura%20santander.png)

Para las graficas anteriores se siguio la siguiente rutina:

<details>

<summary>Mostrar/Ocultar Código</summary>

```{r consumo y cultura, eval=FALSE, echo = TRUE, collapse=TRUE}
reporte_raizal<- function(data, columna, valores, etiquetas, nombre_consumo, departamento, titulo_grafico) {
  cuentas <- c()
  
  for (i in seq_along(valores)) {
    valor <- valores[i]
    cuenta <- sum(data[[columna]] == valor)
    cuentas <- c(cuentas, cuenta)
    
    cat(sprintf(
      "Personas que consumen %s y pertenecen al grupo %s en %s: %s\n", 
      nombre_consumo, etiquetas[i], departamento, cuenta
    ))
  }
  
  # Generar el gráfico
  barplot(
    cuentas,
    names.arg = etiquetas,
    col = c("#c9ecaf", "#367c1a", "#58a92e", "#265409", "#58a92e", "#367c1a"),
    main = sprintf("%s en %s", titulo_grafico, departamento),
    xlab = "Grupo Raizal",
    ylab = "Número de Personas",
    ylim = c(0, max(cuentas) + 5)
  )
}

reporte_raizal(
  data = santander_basuco,
  columna = "D2_01",
  valores = c("1", "2", "3", "4", "5", "9"),
  etiquetas = c("Indígena", "Gitano / ROM", "Raizal Isleño", "Palanquero de San Basilio", "Negro o afrocolombiano", "Ninguno de los anteriores"),
  nombre_consumo = "basuco",
  departamento = "Santander ",
  titulo_grafico = "Pertenencia a culturas raizales y palenqueras del consumidor de basuco"
)

reporte_raizal(
  data = santander_cocaina,
  columna = "D2_01",
  valores = c("1", "2", "3", "4", "5", "9"),
  etiquetas = c("Indígena", "Gitano / ROM", "Raizal Isleño", "Palanquero de San Basilio", "Negro o afrocolombiano", "Ninguno de los anteriores"),
  nombre_consumo = "cocaina",
  departamento = "Santander ",
  titulo_grafico = "Pertenencia a culturas raizales y palenqueras del consumidor de cocaina"
)

reporte_raizal(
  data = santander_extasis,
  columna = "D2_01",
  valores = c("1", "2", "3", "4", "5", "9"),
  etiquetas = c("Indígena", "Gitano / ROM", "Raizal Isleño", "Palanquero de San Basilio", "Negro o afrocolombiano", "Ninguno de los anteriores"),
  nombre_consumo = "extasis",
  departamento = "Santander ",
  titulo_grafico = "Pertenencia a culturas raizales y palenqueras del consumidor de extasis"
)

reporte_raizal(
  data = santander_heroina,
  columna = "D2_01",
  valores = c("1", "2", "3", "4", "5", "9"),
  etiquetas = c("Indígena", "Gitano / ROM", "Raizal Isleño", "Palanquero de San Basilio", "Negro o afrocolombiano", "Ninguno de los anteriores"),
  nombre_consumo = "heroina",
  departamento = "Santander ",
  titulo_grafico = "Pertenencia a culturas raizales y palenqueras del consumidor de heroina"
)

reporte_raizal(
  data = santander_marihuana,
  columna = "D2_01",
  valores = c("1", "2", "3", "4", "5", "9"),
  etiquetas = c("Indígena", "Gitano / ROM", "Raizal Isleño", "Palanquero de San Basilio", "Negro o afrocolombiano", "Ninguno de los anteriores"),
  nombre_consumo = "marihuana",
  departamento = "Santander ",
  titulo_grafico = "Pertenencia a culturas raizales y palenqueras del consumidor de marihuana"
)
```

</details>

5.  Consumo y edad:

![](images/basuco%20edad%20santander.png)

![](images/cocaina%20edad%20santander.png)

![](images/extasis%20edad%20santander.png)

![](images/heroina%20edad%20santander.png)

![](images/marihuana%20edad%20santander.png)

Para las graficas de la edad se siguió la siguiente rutina:

<details>

<summary>Mostrar/Ocultar Código</summary>

```{r consumo y edad, eval=FALSE, collapse=TRUE, echo = TRUE, collapse=TRUE}
analizar_edades <- function(data, columna, nombre_variable = "Variable", intervalos_breaks = NULL) {
  if (!columna %in% names(data)) {
    stop(sprintf("La columna '%s' no existe en el dataset.", columna))
  }
  
  edades <- as.numeric(data[[columna]])
  if (any(is.na(edades))) {
    cat("Aviso: Se encontraron valores NA, que serán excluidos del análisis.\n")
  }
  edades <- edades[!is.na(edades)]
  
  #Se indican los intervalos
  intervalos_breaks = c(0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110)
  
  #Se calculan las medidas generales
  media_general <- mean(edades)
  mediana_general <- median(edades)
  desviacion_general <- sd(edades)
  sesgo <- skewness(edades)
  curtosis <- kurtosis(edades)
  
  # Función para calcular la moda
  calcular_moda <- function(x) {
    uniq_x <- unique(x)
    uniq_x[which.max(tabulate(match(x, uniq_x)))]
  }
  moda_general <- calcular_moda(edades)
  
  # Imprimir estadísticas generales
  cat(sprintf("Análisis de %s\n", nombre_variable))
  cat(sprintf("Media: %.2f\n", media_general))
  cat(sprintf("Mediana: %.2f\n", mediana_general))
  cat(sprintf("Moda: %d\n", moda_general))
  cat(sprintf("Desviación Estándar: %.2f\n\n", desviacion_general))
  
  
  # Crear intervalos
  intervalos <- cut(
    edades, 
    breaks = intervalos_breaks, 
    right = FALSE, 
    labels = paste(head(intervalos_breaks, -1), tail(intervalos_breaks, -1) - 1, sep = "-")
  )
  
  # Tabla de frecuencias
  tabla_frecuencias <- table(intervalos)
  
  # Visualizaciones 3 graficos
  par(mfrow = c(1, 3))
  
  # Histograma
  hist(edades, 
       breaks = intervalos_breaks, 
       right = FALSE, 
       col = "darkgreen", 
       main = paste("Distribución de", nombre_variable), 
       xlab = "Intervalos de Edad", 
       ylab = "Frecuencia")
  
  # Diagrama de barras
  barplot(tabla_frecuencias, 
          col = "lightgreen", 
          main = paste("Frecuencia de", nombre_variable), 
          xlab = "Intervalos de Edad", 
          ylab = "Frecuencia")
  
  # Boxplot
  boxplot(edades, 
          main = paste("Boxplot de", nombre_variable), 
          ylab = "Edades", 
          col = "#028a0f", 
          horizontal = FALSE)
  abline(h = mediana_general, col = "#64c27b", lwd = 2, lty = 2)  # Línea de la mediana en azul
  abline(h = media_general, col = "#203500", lwd = 2, lty = 2)  # Línea de la media en rojo
  text(x = 1, y = moda_general, labels = paste("Moda:", moda_general), pos = 4, col = "#203500", cex = 1.2)
  
}

resultados <- analizar_edades(
  data = santander_basuco,
  columna = "EDAD", 
  nombre_variable = "Edades consumo basuco Santander "  
)

####
resultados <- analizar_edades(
  data = santander_cocaina,
  columna = "EDAD", 
  nombre_variable = "Edades consumo cocaina Santander "  
)

####
resultados <- analizar_edades(
  data = santander_extasis,
  columna = "EDAD", 
  nombre_variable = "Edades consumo extasisSantander s"  
)

###
resultados <- analizar_edades(
  data = santander_heroina,
  columna = "EDAD", 
  nombre_variable = "Edades consumo heroina Santander "  
)

###
resultados <- analizar_edades(
  data = santander_marihuana,
  columna = "EDAD", 
  nombre_variable = "Edades consumo marihuana Santander "  
)
```

</details>
